---
layout:     post
title:      "计算机网络-应用层"
subtitle:   " \"基础内容\""
date:       2021-03-15 12:00:00
author:     "Zm"
header-img: "img/post-bg-2020.jpg"
tags:
    - 计算机网络
---

# 应用层

## Web和HTTP

**Web的运用层协议是超文本传输协议（HTTP）**，它是Web的核心。一个客户程序在一个服务器程序。客户程序和服务器程序运行在不同的端系统中，通过交换HTTP报文进行会话。HTTP定义了这些报文的结构以及客户和服务器进行报文交换的方式。

HTTP使用TCP作为它的支撑运输协议。TCP是一种可靠的传输协议。所以**HTTP协议不同担心数据丢失**，也不关注TCP从网络的数据丢失和乱序故障中恢复的细节。那是TCP以及协议栈较低层协议的工作。

由于HTTP服务器不会保存任何用户的信息，即使你刚刚访问过该服务器。因此HTTP是一个**无状态协议**。

### 持续连接和非持续连接

每个请求/响应对是经一个单独的TCP单独发送的，称为使用非持续连接。所有的请求及其响应经相同的TCP连接发送，称为持续连接。HTTP支持两种连接方式，默认使用持续连接。

### HTTP报文格式

> HTTP请求报文

请求报文范例（请求行—首部行—空行—实体体（空））

```html
GET /somedir/page.html HTTP/1.1
Host:www.someschool.edu
Connection:close
User-agent:Mozilla/5.0
Accept-language:fr

(...实体体)
```

HTTP请求报文的第一行叫做请求行。

请求行有3个字段：方法字段、URL字段和HTTP版本字段。

方法字段可以去不同的值，GET、POST、HEAD、PUT和DELETE。HEAD方法类似于GET方法。当服务器收到一个使用HEAD方法的请求时，将会用一个HTTP报文进行响应，但是不返回请求对象。应用程序开发者常用HEAD方法进行调试追踪。

第一行之后的行叫做首部行。

在首部行之后，有一个空行，然后是实体体的部分，请求报文中实体体的内容为空。

> HTTP响应报文

响应报文范例（初始状态行—首部行—空行—实体体）

```html
HTTP/1.1 200 OK
Connection:close
Date:Tue,18 Aug 2015 15:44:04 GMT
Server:Apache/2.2.3(Centos)
Last-Modified:Tue,18 Aug 2015 15:11:03 GMT
Content-Length:6821
Content-Type:text/html

(实体体...)
```

响应报文的第一部分是初始状态行，它有3个字段：协议版本字段、状态码和相应状态信息。

第二部分是首部行。

第三部分是一个固定的空行，用于分隔首部行和实体体

最后部分是实体体，里面存放的是响应数据。

### Cookie

HTTP服务器是无状态的，如果一个Web站点希望能够识别用户，就要使用Cookie。

当用户访问一个从来未访问过的网站时，服务器会为用户创建某个ID，例如1001，用这个ID在后台数据库中创建一个表项，同时在响应报文的首部行中会加入`set-cookie:1001`。用户本地浏览器接收到这个报文，就会在它管理的特定cookie文件中添加一行，该行包含服务器的主机名和`Set-cookie`中的ID。当用户再次访问该网站时，浏览器就会在请求报文的首部行中添加`cookie:1001`，该网站获取请求，根据cookie中的值查询数据库。就能获得用户的信息。至此，cookie完成了标识一个用户的任务。

### Web缓存

Web缓存器也叫代理服务器，它能够代表初始Web服务器来满足HTTP请求的网络实体。

当用户的浏览器配置了代理服务器之后，用户所有的请求就会首先指向代理服务器。

- 浏览器创建一个TCP连接，并向Web缓存器中的对象发送一个HTTP请求。
- 缓存器进行检查，看看本地是否保存了该对象的副本，如果有就直接将该对象响应返回
- 如果没有，缓存器将打开一个该对象的初始服务器的TCP连接，初始服务器收到请求后，将该对象响应返回给缓存器。
- 当缓存器收到该对象时，将会在本地存储一份该对象副本，并向客户的浏览器用HTTP响应报文发送该副本。

在因特网上部署Web缓存器有两个原因。

首先，Web缓存器可以大大减少对客户请求的响应时间，特别是当客户与初始服务器之间的瓶颈带宽远低于客户与Web缓存器之间的瓶颈带宽时更是如此。

Web缓存器能够大大减少一个机构的接入链路到因特网的通信量。

### 条件GET方法

尽管高速缓存能够减少用户感受到的响应时间，但也引入了一个新的问题，即存放在缓存器中的对象副本可能是陈旧的。幸运的是，HTTP协议有一种机制，允许缓存器证实它的对象是最新的。这个机制就是条件GET方法。

如果，请求报文使用的是GET方法，并且请求报文中包含一个`If-Modified-Since`首部行，那么就是一个条件GET请求报文。

在缓存器从初始处理器中拉取对象之后，在转发到请求的浏览器的同时，会在本地缓存该对象。重要的是，在缓存对象的同时，会保存对象的最后修改日期。经过一段时间后，用户再次请求该对象，缓存器会先发送一个条件GET请求报文给初始服务器，请求报文中会包含对象的最后修改日期，初始服务器收到报文后，会对比日期，如果没有问题，会发送一个不包含对象的响应报文，告诉缓存器可以使用缓存的对象副本。如果日期不一，初始服务器会发送一个包含最新最新的响应报文，告诉缓存器需要更新缓存 对象数据。

## 因特网中的电子邮件

因特网电子邮件系统主要有3个主要组成部分：用户代理、邮件代理器和简单邮件传输协议。

### SMTP

SMTP是因特网电子邮件中主要的应用层协议

- A使用它的用户代理程序并提供B的邮件地址，撰写报文，指示用户代理程序发送报文。
- 用户代理将报文发送给邮件服务器，该报文会被放在服务器的报文队列中。
- 运行在A的邮件服务器中的SMTP客户端发现了报文队列中的这个报文，它就创建一个连接到B的用户服务器中的SMTP服务器的TCP连接
- 在经过一些初始的SMTP握手之后，SMTP客户端通过该TCP连接发送A的报文。
- 在B的邮件服务器中，SMTP的服务器端接收该报文，B的邮件服务器将该报文放入B的邮箱中。
- B在空闲时，可以调用用户代理阅读该报文。

SMTP一般不使用中间邮件服务器，TCP连接是从发送方的SMTP客户端到接收方的SMTP服务器端直接连接。如果接收方的SMTP服务器端没有打开，那么邮件会被保存在发送端的邮件服务器中，并等待进行新的连接尝试。

## DNS | 因特网目录服务

因特网上的主机和人类一样，可以使用多种方式进行标识，一种是采用主机名，例如www.google.com，而外一种是使用IP地址的方式。人们喜欢便于记忆的主机名的方式，而路由器则喜欢定长的、有着层次结构的IP地址。为了满足两者的需求，我们需要有一种从主机名到IP地址转换的目录服务。这就是域名系统（DNS）的主要任务。

DNS主要有两部分组成：①一个有分层的DNS服务器实现的分布式数据库②一个使得主机能够查询分布式数据库的应用层协议。

除了从主机名到IP地址的转换外，DNS还提供了一些重要的服务：

- 主机别名
- 邮件服务器别名
- 负载分配

### 分布式、层次服务器

为了处理扩展性问题，DNS使用了大量的DNS服务器，它们以层次方式组织，并且分布在全世界范围内。

大致来说，有3种类型的DNS服务器。

- 根DNS服务器
- 顶级域（DNS）服务器
- 权威（DNS）服务器

根、TLD和权威DNS服务器都处在该DNS服务器的层次结构中，还有另一类重要的DNS服务器，称为**本地DNS服务器**。 